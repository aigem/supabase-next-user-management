项目概述
该项目基于 Next.js 15 的 App Router 与 Supabase 提供的身份验证、数据库以及 Edge Functions 服务，旨在快速构建一款 API 调用中文应用.
用户注册登录后，可通过前端界面调用图像或视频生成等收费 API，系统需实时扣费并提供充值与邀请奖励功能.
核心需求
用户注册登录与权限管理
接入第三方支付系统（预留接口规范）
充值流水与支付回调处理
按调用次数与单价自动扣减余额
API 调用统计与使用报表
邀请注册奖励额度分发
技术栈与架构
前端采用 Next.js 15 App Router 与服务端组件 (Server Components)，并利用 React Cache 与 Server Actions 优先处理服务端状态.
后端业务逻辑请根据程序实际来完成。
在 app/api/ 目录下创建路由处理器，用于接收支付回调、执行充值后余额更新，以及根据调用次数和单价进行扣费.
通过 @supabase/supabase-js 在服务端安全地连接数据库，并在 Route Handlers 中使用 Supabase 服务端客户端实现用户认证、数据增删改查.
数据库与安全
设计用户表、充值记录表、调用日志表与邀请关系表，表间通过外键关联并添加必要索引提升查询性能.
确保用户只能访问自身数据，并通过审计触发器记录关键操作日志.
支付与财务流程
环境变量中配置支付网关密钥与回调地址，前端调用支付接口发起订单，后端接收 webhook 通知并存储回调数据.
实现“充值→到账→可用余额更新”闭环.
实现细节与最佳实践
封装 Supabase 客户端与认证 Hook，统一管理 session、错误处理与加载状态.
测试覆盖建议采用 Jest 进行单元测试与 Cypress 进行端到端测试，确保关键流程稳定.
代码提交前进行 ESLint 与 Prettier 检查，并使用 Git 分支策略（feature/bugfix）保持主分支可部署.
以上为我的思考，如果有不足请补充完善并根据程序实际优化后为我实施，且分步按计划地实施，请遵循 KISS 极简原则来编写代码及编辑程序文件等。


 f:\ai来事\supabase-next-user-management\需求.md
 请根据程序实际、最佳实践及我的需求来为我在现有程序的基础上创建我所需要的程序。计划清单等回复最好也用中文。



aid 及 app secret 放到.env 中提供。
这个支持接口非常 简单。说明一下真实的使用流程：

需要登录的且是验证了邮箱的用户，他需要充值，点击预设的充值金额，或可以由用户自定义输入充值金额来充值。
就是调用支付宝当面付的api来生成充值的二维码，有了这个用户扫码支付。好像是手机页面中调用这个，是会唤醒支付宝程序来完成支付。
支付完成后api就会返回充值成功等数据。你需要根据这些数据来给用户充值相应的金额。
请更新程序的支付接口接入及更新环境变量值等。